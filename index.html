<script>
  const gallery = document.getElementById('gallery');

  async function loadImages() {
    const category = document.getElementById('category').value;
    const device = document.getElementById('device').value;
    const mode = document.getElementById('mode').value;
    const encodedMode = encodeURIComponent(mode);
    const baseUrl = `https://slideui.github.io/block-images/${category}/${device}/${encodedMode}/`;

    // Show loading state without clearing everything instantly
    gallery.innerHTML = `<p style="opacity:0.7;">Loading ${category} blocks...</p>`;

    const imageCount = 10;
    const blocks = [];

    for (let i = 1; i <= imageCount; i++) {
      const fileName = `${category} Blocks-${i}_result_result.webp`;
      const imageUrl = `${baseUrl}${fileName}`;

      // Preload the image to check if it exists
      const img = new Image();
      img.src = imageUrl;
      await new Promise((resolve) => {
        img.onload = () => {
          blocks.push(`
            <div class="block fade-in">
              <img src="${imageUrl}" alt="${category} ${i}" loading="lazy">
              <div class="block-info">
                <h3>${category} Block ${i}</h3>
                <span>${mode}</span>
              </div>
            </div>
          `);
          resolve();
        };
        img.onerror = resolve; // Skip missing ones silently
      });
    }

    // Fade transition
    gallery.style.opacity = 0;
    setTimeout(() => {
      gallery.innerHTML = blocks.length
        ? blocks.join('')
        : `<p style="opacity:0.6;">No blocks found for ${category} (${mode})</p>`;
      gallery.style.opacity = 1;
    }, 200);
  }
</script>

<style>
  .fade-in {
    animation: fadeIn 0.5s ease-in forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
