<script>
  window.addEventListener("DOMContentLoaded", () => {
    const base = `${location.origin}/block-images`;
    const categories = ["404"];
    const catSelect = document.getElementById("category");
    const deviceSelect = document.getElementById("device");
    const modeSelect = document.getElementById("mode");
    const gallery = document.getElementById("gallery");
    const loading = document.getElementById("loading");

    categories.forEach(cat => {
      const opt = document.createElement("option");
      opt.textContent = cat;
      catSelect.appendChild(opt);
    });

    async function loadImages() {
      const category = catSelect.value;
      const device = deviceSelect.value;
      const mode = modeSelect.value;

      gallery.innerHTML = "";
      loading.textContent = "Loading blocks…";

      // Build all URLs first
      const urls = Array.from({ length: 80 }, (_, i) => 
        `${base}/${category}/${device}/${mode}/${category} Error Blocks-${i + 1}_result_result.webp`
      );

      let foundCount = 0;
      loading.textContent = "Scanning images…";

      // Parallel check — load images directly, skip HEAD requests
      urls.forEach(url => {
        const img = new Image();
        img.src = url;
        img.loading = "lazy";
        img.onerror = () => {}; // ignore missing files
        img.onload = () => {
          foundCount++;
          gallery.appendChild(img);
          loading.textContent = `Loaded ${foundCount} blocks…`;
        };
      });

      // Auto-clear loading text once some images have loaded
      setTimeout(() => {
        loading.textContent = foundCount
          ? ""
          : "No images found for this mode.";
      }, 4000);
    }

    catSelect.addEventListener("change", loadImages);
    deviceSelect.addEventListener("change", loadImages);
    modeSelect.addEventListener("change", loadImages);

    catSelect.value = "404";
    loadImages();
  });
</script>
